# =============================================================================
# Curriculum Template CMS Configuration
# =============================================================================
# This is a TEMPLATE file. The actual config.yml is generated at build time
# from environment variables. See docs/cms-setup.md for setup instructions.
#
# Required environment variables (set in Netlify):
#   CMS_REPO     - Your GitHub username/repo (e.g., "username/repo-name")
#   CMS_AUTH_URL - Your Cloudflare Worker URL (e.g., "https://my-auth.workers.dev")
#
# Schema Version: 2.1 (Improved field ordering and UX)
# =============================================================================

backend:
  name: github
  repo: ${CMS_REPO}
  branch: main
  base_url: ${CMS_AUTH_URL}

media_folder: static/images
public_folder: /images

slug:
  encoding: ascii
  clean_accents: true
  sanitize_replacement: '-'

collections:
  # ==========================================================================
  # CLUSTERS
  # Thematic groupings of lessons. Each cluster contains multiple lessons.
  # ==========================================================================
  - name: clusters
    label: Clusters
    label_singular: Cluster
    folder: content/clusters
    create: true
    slug: '{{slug}}'
    sortable_fields: ['order', 'title']
    summary: '{{order}}. {{title}}'
    preview_path: 'curriculum/{{slug}}'
    fields:
      - label: Title
        name: title
        widget: string
        hint: "The name of this cluster (e.g., 'Getting Started', 'Core Concepts')"
      - label: Order
        name: order
        widget: number
        value_type: int
        min: 1
        hint: "Display order (1 = first cluster shown)"
      - label: Slug
        name: slug
        widget: string
        pattern: ['^[a-z0-9]+(?:-[a-z0-9]+)*$', "Use lowercase letters, numbers, and hyphens only"]
        hint: "URL identifier (e.g., 'getting-started')"
      - label: Description
        name: description
        widget: text
        hint: "Brief description shown on curriculum overview (1-2 sentences)"
      - label: Overview
        name: body
        widget: markdown
        required: false
        hint: "Optional longer introduction shown on cluster page"

  # ==========================================================================
  # LESSONS
  # Individual lessons within clusters. Each lesson typically covers one reading.
  # ==========================================================================
  - name: lessons
    label: Lessons
    label_singular: Lesson
    folder: content/lessons
    create: true
    slug: '{{cluster}}-{{slug}}'
    sortable_fields: ['order', 'title', 'cluster']
    summary: '{{cluster}} / {{order}}. {{title}}'
    preview_path: 'curriculum/{{cluster}}/{{slug}}'
    fields:
      # ═══════════════════════════════════════════════════════════════════════
      # ESSENTIAL METADATA (What is this lesson?)
      # ═══════════════════════════════════════════════════════════════════════
      - label: Title
        name: title
        widget: string
        hint: "The title of this lesson"

      - label: Cluster
        name: cluster
        widget: relation
        collection: clusters
        value_field: slug
        search_fields: ['title', 'slug']
        display_fields: ['title']
        hint: "Which cluster this lesson belongs to"

      - label: Order
        name: order
        widget: number
        value_type: int
        min: 1
        hint: "Position within the cluster (1 = first lesson)"

      - label: Slug
        name: slug
        widget: string
        pattern: ['^[a-z0-9]+(?:-[a-z0-9]+)*$', "Use lowercase letters, numbers, and hyphens only"]
        hint: "URL identifier (e.g., 'social-construction')"

      - label: Description
        name: description
        widget: text
        hint: "1-2 sentences shown in lesson listings"

      # ═══════════════════════════════════════════════════════════════════════
      # CORE CONTENT (What do learners engage with?)
      # ═══════════════════════════════════════════════════════════════════════
      - label: Introduction
        name: body
        widget: markdown
        required: false
        hint: "Context and significance of the reading (2-4 paragraphs)"

      - label: Assignment
        name: assignment
        widget: object
        required: false
        collapsed: true
        fields:
          - { label: Instructions, name: instructions, widget: markdown }
          - { label: Reading URL, name: url, widget: string, required: false, hint: "Link to access the reading" }
          - { label: Reading Title, name: reading_title, widget: string, required: false, hint: "Full citation" }
        hint: "The primary reading with access link"

      # ═══════════════════════════════════════════════════════════════════════
      # CONTENT BLOCKS (Unified component system)
      # All card-like components in a single, flexible list
      # ═══════════════════════════════════════════════════════════════════════
      - label: Content Blocks
        name: blocks
        widget: list
        required: false
        collapsed: true
        minimize_collapsed: true
        max: 15
        hint: "Add objectives, concepts, questions, resources, and callouts (max 15)"
        types:
          # Learning Objectives Block
          - label: "πŸ"‹ Learning Objectives"
            name: objectives
            widget: object
            fields:
              - label: Objectives
                name: items
                widget: list
                field: { label: Objective, name: item, widget: string }

          # Key Concept Block
          - label: "πŸ'' Key Concept"
            name: concept
            widget: object
            fields:
              - { label: Concept Name, name: name, widget: string }
              - { label: Explanation, name: explanation, widget: markdown }

          # Knowledge Check Block
          - label: "❓ Knowledge Check"
            name: check
            widget: object
            fields:
              - { label: Question, name: question, widget: string }
              - { label: Hint, name: hint, widget: text, required: false }

          # Resource Block
          - label: "πŸ"— Resource"
            name: resource
            widget: object
            fields:
              - { label: Title, name: title, widget: string }
              - { label: Author, name: author, widget: string, required: false }
              - { label: URL, name: url, widget: string, required: false }
              - { label: Description, name: description, widget: text }

          # Callout Blocks (various types)
          - label: "πŸ€" Ask Yourself"
            name: ask
            widget: object
            fields:
              - { label: Title (optional), name: title, widget: string, required: false }
              - { label: Content, name: content, widget: markdown }

          - label: "πŸ" Example"
            name: example
            widget: object
            fields:
              - { label: Title (optional), name: title, widget: string, required: false }
              - { label: Content, name: content, widget: markdown }

          - label: "πŸ'' Tip"
            name: tip
            widget: object
            fields:
              - { label: Title (optional), name: title, widget: string, required: false }
              - { label: Content, name: content, widget: markdown }

          - label: "⚠️ Important"
            name: important
            widget: object
            fields:
              - { label: Title (optional), name: title, widget: string, required: false }
              - { label: Content, name: content, widget: markdown }

          - label: "❔ Reflection"
            name: reflection
            widget: object
            fields:
              - { label: Title (optional), name: title, widget: string, required: false }
              - { label: Content, name: content, widget: markdown }

          - label: "πŸ•' Context"
            name: context
            widget: object
            fields:
              - { label: Title (optional), name: title, widget: string, required: false }
              - { label: Content, name: content, widget: markdown }

      # ═══════════════════════════════════════════════════════════════════════
      # EXTRAS (Optional enhancements)
      # ═══════════════════════════════════════════════════════════════════════
      - label: Reading Author
        name: author
        widget: string
        required: false
        hint: "Author of the primary reading (optional)"

      - label: Featured Image
        name: featured_image
        widget: image
        required: false
        hint: "Optional header image"

      - label: Hidden Sections
        name: hidden_sections
        widget: select
        multiple: true
        required: false
        options:
          - { label: "Introduction", value: "body" }
          - { label: "Assignment", value: "assignment" }
          - { label: "Content Blocks", value: "blocks" }
        hint: "Temporarily hide sections without deleting content"

  # ==========================================================================
  # PAGES
  # Static pages like About and Home
  # ==========================================================================
  - name: pages
    label: Pages
    files:
      - name: home
        label: Home Page
        file: content/pages/home.md
        fields:
          - label: Title
            name: title
            widget: string
            hint: "Main curriculum title (displayed prominently)"
          - label: Tagline
            name: tagline
            widget: text
            hint: "One-sentence value proposition"
          - label: CTA Button Text
            name: cta_text
            widget: string
            default: "Begin Reading"
            hint: "Call-to-action button text"
          - label: Approach Section
            name: body
            widget: markdown
            required: false
            hint: "Optional philosophy/methodology section below clusters"

      - name: about
        label: About Page
        file: content/pages/about.md
        fields:
          - { label: Title, name: title, widget: string }
          - { label: Subtitle, name: subtitle, widget: string, required: false }
          - { label: Content, name: body, widget: markdown }

  # ==========================================================================
  # SETTINGS
  # Site-wide configuration
  # ==========================================================================
  - name: settings
    label: Settings
    files:
      - name: site
        label: Site Settings
        file: content/settings/site.json
        fields:
          - label: Site Title
            name: title
            widget: string
            hint: "Shown in browser tab and SEO"
          - label: Site Description
            name: description
            widget: text
            hint: "SEO description (1-2 sentences)"
          - label: Author Name
            name: author
            widget: string
            hint: "Your name or organization"
          - label: Author URL
            name: substack_url
            widget: string
            required: false
            hint: "Link to your website, Substack, etc."
          - label: Footer Text
            name: footer_text
            widget: string
            hint: "Tagline shown in footer"
